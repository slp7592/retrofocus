<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.gstatic.com https://firebasestorage.googleapis.com https://*.firebasedatabase.app; style-src 'self' 'unsafe-inline'; connect-src https://*.firebaseio.com https://*.firebasedatabase.app https://*.googleapis.com https://www.gstatic.com wss://*.firebaseio.com wss://*.firebasedatabase.app; frame-src https://*.firebasedatabase.app;">
    <title>RÃ©trospective Sprint</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Modal de configuration Firebase -->
    <div id="setupModal" class="setup-modal">
        <div class="setup-content">
            <h2>ğŸ”§ Configuration Firebase</h2>
            <p>Pour utiliser cet outil en collaboration temps rÃ©el, configurez Firebase (gratuit) :</p>

            <ol style="color: #4a5568; margin: 20px 0; line-height: 1.8;">
                <li>CrÃ©ez un projet sur <a href="https://console.firebase.google.com" target="_blank" style="color: #667eea;">Firebase Console</a></li>
                <li>Activez <strong>Realtime Database</strong> (mode test)</li>
                <li>ParamÃ¨tres â†’ Vos applications â†’ Web (icÃ´ne &lt;/&gt;)</li>
                <li>Copiez chaque valeur dans les champs ci-dessous :</li>
            </ol>

            <div class="form-group">
                <label>API Key *</label>
                <input type="text" id="apiKey" placeholder="AIzaSy...">
            </div>

            <div class="form-group">
                <label>Auth Domain *</label>
                <input type="text" id="authDomain" placeholder="votre-projet.firebaseapp.com">
            </div>

            <div class="form-group">
                <label>Database URL *</label>
                <input type="text" id="databaseURL" placeholder="https://votre-projet-default-rtdb.europe-west1.firebasedatabase.app">
            </div>

            <div class="form-group">
                <label>Project ID *</label>
                <input type="text" id="projectId" placeholder="votre-projet">
            </div>

            <div class="form-group">
                <label>Storage Bucket</label>
                <input type="text" id="storageBucket" placeholder="votre-projet.appspot.com">
            </div>

            <div class="form-group">
                <label>Messaging Sender ID</label>
                <input type="text" id="messagingSenderId" placeholder="123456789012">
            </div>

            <div class="form-group">
                <label>App ID</label>
                <input type="text" id="appId" placeholder="1:123456789012:web:abc123">
            </div>

            <div class="alert alert-warning" style="margin-top: 20px;">
                âš ï¸ AprÃ¨s initialisation, ajoutez ces rÃ¨gles de sÃ©curitÃ© dans Firebase (onglet RÃ¨gles) :
            </div>

            <textarea class="config-input" readonly style="min-height: 400px;">{
  "rules": {
    "sessions": {
      "$sessionId": {
        ".read": true,
        ".write": true,
        "users": {
          "$userId": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 30"
          }
        },
        "positive": {
          "$cardId": {
            ".validate": "newData.hasChildren(['id', 'content', 'author', 'votes', 'timestamp']) && newData.child('content').val().length <= 200 && newData.child('author').val().length <= 30"
          }
        },
        "negative": {
          "$cardId": {
            ".validate": "newData.hasChildren(['id', 'content', 'author', 'votes', 'timestamp']) && newData.child('content').val().length <= 200 && newData.child('author').val().length <= 30"
          }
        },
        "action": {
          "$cardId": {
            ".validate": "newData.hasChildren(['id', 'content', 'author', 'votes', 'timestamp']) && newData.child('content').val().length <= 200 && newData.child('author').val().length <= 30"
          }
        }
      }
    }
  }
}</textarea>

            <button class="btn btn-primary" onclick="initializeFirebase()" style="width: 100%; margin-top: 10px;">
                ğŸš€ Initialiser Firebase
            </button>
        </div>
    </div>

    <!-- Application principale -->
    <div class="container" id="mainApp" style="display: none;">
        <div class="app-layout">
            <div class="main-content">
                <header>
                    <img src="retrofocus.png" alt="Retrofocus" class="logo-banner">
                    <div id="headerSessionId" style="display: none; color: #667eea; font-weight: 600; font-size: 14px; cursor: pointer;" onclick="copySessionIdToClipboard()" title="Cliquer pour copier l'ID de session">
                        Session: <span id="headerSessionIdText"></span>
                    </div>
                    <div class="session-info">
                        <div class="user-name">
                            <span>ğŸ‘¤</span>
                            <input type="text" id="userName" placeholder="Votre nom" maxlength="30">
                        </div>
                        <div id="votesRemaining" style="display: none; color: #667eea; font-weight: 600; margin-right: 15px;">
                            ğŸ‘ Votes restants: <span id="votesCount">3</span>
                        </div>
                        <button id="clearAllBtn" class="btn btn-danger" onclick="clearAll()">ğŸ—‘ï¸ Tout effacer</button>
                    </div>
                </header>

        <!-- Bandeau de progression des phases -->
        <div id="phaseStepper" style="display: none;">
            <div class="phase-stepper">
                <div class="phase-step" data-phase="reflexion">
                    <div class="phase-step-icon">ğŸ’­</div>
                    <div class="phase-step-label">RÃ©flexion</div>
                </div>
                <div class="phase-step-connector"></div>
                <div class="phase-step" data-phase="vote">
                    <div class="phase-step-icon">ğŸ‘</div>
                    <div class="phase-step-label">Vote</div>
                </div>
                <div class="phase-step-connector"></div>
                <div class="phase-step" data-phase="action">
                    <div class="phase-step-icon">ğŸ¯</div>
                    <div class="phase-step-label">Actions</div>
                </div>
            </div>
            <div id="phaseControls" style="display: none; text-align: center; margin-top: 15px;">
                <button id="nextPhaseBtn" class="btn btn-primary" onclick="nextPhase()"></button>
            </div>
        </div>

        <div class="session-section">
            <h3>ğŸ”— Session</h3>
            <div class="session-controls">
                <input type="text" id="sessionIdInput" placeholder="Entrez un ID de session" style="flex: 1; min-width: 200px;">
                <button class="btn btn-primary" onclick="joinSession()">Rejoindre</button>
                <button class="btn btn-secondary" onclick="createNewSession()">Nouvelle session</button>
            </div>
            <div id="currentSession" style="margin-top: 15px; display: none;">
                <p style="color: #718096; margin-bottom: 10px;">
                    <span class="status-indicator online"></span>
                    Session active - Temps rÃ©el activÃ©
                </p>
                <div class="session-id" id="sessionIdDisplay" onclick="copySessionId()" title="Cliquer pour copier"></div>
                <p style="color: #718096; font-size: 12px; margin-top: 10px;">
                    ğŸ“‹ Cliquez sur l'ID pour copier et partager avec votre Ã©quipe
                </p>
            </div>
        </div>

        <div class="columns">
            <div class="column positive">
                <div class="column-header">
                    <span class="column-icon">ğŸ˜Š</span>
                    <h2 class="column-title">Points positifs</h2>
                </div>
                <div class="add-card">
                    <input type="text" id="inputPositive" placeholder="Qu'est-ce qui a bien fonctionnÃ© ?" maxlength="200">
                    <button class="btn btn-primary" onclick="addCard('positive')">+</button>
                </div>
                <div id="cardsPositive"></div>
            </div>

            <div class="column negative">
                <div class="column-header">
                    <span class="column-icon">ğŸ˜Ÿ</span>
                    <h2 class="column-title">Points Ã  amÃ©liorer</h2>
                </div>
                <div class="add-card">
                    <input type="text" id="inputNegative" placeholder="Qu'est-ce qui pourrait Ãªtre amÃ©liorÃ© ?" maxlength="200">
                    <button class="btn btn-primary" onclick="addCard('negative')">+</button>
                </div>
                <div id="cardsNegative"></div>
            </div>

            <div class="column action">
                <div class="column-header">
                    <span class="column-icon">ğŸ¯</span>
                    <h2 class="column-title">Actions</h2>
                </div>
                <div class="add-card">
                    <input type="text" id="inputAction" placeholder="Quelle action mettre en place ?" maxlength="200">
                    <button class="btn btn-primary" onclick="addCard('action')">+</button>
                </div>
                <div id="cardsAction"></div>
            </div>
        </div>

        <div class="timer">
            <h3>â±ï¸ Minuteur</h3>
            <div class="timer-display" id="timerDisplay">5:00</div>
            <div class="timer-controls">
                <button class="btn btn-primary" onclick="startTimer(5)">5 min</button>
                <button class="btn btn-primary" onclick="startTimer(7)">7 min</button>
                <button class="btn btn-primary" onclick="startTimer(10)">10 min</button>
                <button class="btn btn-danger" onclick="resetTimer()">â¹ï¸ Stop</button>
            </div>
        </div>

        <div class="export-section">
            <h3>ğŸ“Š Exporter la rÃ©trospective</h3>
            <button class="btn btn-primary" onclick="exportData()">ğŸ“¥ TÃ©lÃ©charger (JSON)</button>
        </div>
            </div>

            <!-- Sidebar des participants -->
            <aside id="participantsSidebar" class="participants-sidebar" style="display: none;">
                <div class="sidebar-header">
                    <h3>ğŸ‘¥ Participants</h3>
                    <span id="participantsCount" class="participants-count">0</span>
                </div>
                <div id="participantsNames" class="participants-list"></div>
            </aside>
        </div>
    </div>

    <!-- Modal de notification personnalisÃ© -->
    <div id="customModal" class="custom-modal" style="display: none;">
        <div class="custom-modal-overlay"></div>
        <div class="custom-modal-content">
            <div class="custom-modal-icon" id="modalIcon"></div>
            <div class="custom-modal-message" id="modalMessage"></div>
            <div class="custom-modal-buttons" id="modalButtons"></div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
